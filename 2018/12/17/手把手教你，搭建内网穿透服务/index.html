<!DOCTYPE html>
<html lang=zh>


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000">
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top">
  
  
  <title>手把手教你，搭建内网穿透服务 | Frank&#39;s 技术世界</title>
  <meta name="description" content="在很多场景下内网穿透都是我们常常遇到的需求，之前也用过花生壳、ngrok、FRP 等等一些工具，但是由于限速、收费、安全各方面因素只好放弃了。 目前所在实验室主要从事深度学习和机器学习相关工作，有一台高配 GPU 计算型服务器，大家使用 Jupyter Notebook 在网页上进行编码工作，但是只能在学院内网才能进行使用，在外面就无法使用让人比较抓狂。如果购买阿里云等深度学习服务，价格昂贵，只好">
<meta name="keywords" content="内网穿透">
<meta property="og:type" content="article">
<meta property="og:title" content="手把手教你，搭建内网穿透服务">
<meta property="og:url" content="http://www.frankfeekr.cn/2018/12/17/手把手教你，搭建内网穿透服务/index.html">
<meta property="og:site_name" content="Frank&#39;s 技术世界">
<meta property="og:description" content="在很多场景下内网穿透都是我们常常遇到的需求，之前也用过花生壳、ngrok、FRP 等等一些工具，但是由于限速、收费、安全各方面因素只好放弃了。 目前所在实验室主要从事深度学习和机器学习相关工作，有一台高配 GPU 计算型服务器，大家使用 Jupyter Notebook 在网页上进行编码工作，但是只能在学院内网才能进行使用，在外面就无法使用让人比较抓狂。如果购买阿里云等深度学习服务，价格昂贵，只好">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1547174721865.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1546568207628.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1546568207628.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544795186699.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544795764181.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798600592.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798624799.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798600592.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798624799.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/20170724230855998.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544797073237.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544797106999.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544797593907.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544797708925.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798196919.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798600592.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798624799.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798600592.png">
<meta property="og:image" content="http://www.frankfeekr.cn/assets/1544798624799.png">
<meta property="og:image" content="https://img.shields.io/badge/知乎专栏-frankfeekr-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/CSDN-东风牧野-red.svg">
<meta property="og:image" content="https://img.shields.io/badge/Email-frank__lin@whu.edu.cn-lightgrey.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ群-862619503-green.svg">
<meta property="og:image" content="https://raw.githubusercontent.com/frank-lam/fullstack-tutorial/master/assets/wechat-fullstack.png">
<meta property="og:updated_time" content="2021-10-23T14:22:52.651Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="手把手教你，搭建内网穿透服务">
<meta name="twitter:description" content="在很多场景下内网穿透都是我们常常遇到的需求，之前也用过花生壳、ngrok、FRP 等等一些工具，但是由于限速、收费、安全各方面因素只好放弃了。 目前所在实验室主要从事深度学习和机器学习相关工作，有一台高配 GPU 计算型服务器，大家使用 Jupyter Notebook 在网页上进行编码工作，但是只能在学院内网才能进行使用，在外面就无法使用让人比较抓狂。如果购买阿里云等深度学习服务，价格昂贵，只好">
<meta name="twitter:image" content="http://www.frankfeekr.cn/assets/1547174721865.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.frankfeekr.cn/2018/12/17/手把手教你，搭建内网穿透服务/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Frank&#39;s 技术世界" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png" type="image/x-icon">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.css"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  
</head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">

  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/frank-lam" target="_blank">
          <img class="img-circle img-rotate" src="/img/avatar2.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Frank</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">from zero to hero</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Hangzhou</small><br>
        <!-- <small id="location" class="text-muted hidden-xs hidden-sm"> 潜伏在黎明之前，混迹于互联网江湖。</small><br> -->

        <!-- <span class="article-read hidden-xs">
            <i class="icon icon-eye-fill" aria-hidden="true"></i>
            <span id="busuanzi_container_page_pv">
            <span id="busuanzi_value_page_pv">0</span>
          </span>
        </span> -->

        <!-- <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-location-arrow"></i> frank_lin@whu.edu.cn</small> -->
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索">
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech>
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-lintools">
          <a href="/lintools">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">在线导航</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/tools">
            
            <i class="icon icon-shu"></i>
            
            <span class="menu-title">四次元ポケット</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-author">
          <a href="/author">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">作者</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/frank-lam" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/Lam_Frank" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://www.zhihu.com/people/hifrank/" target="_blank" title="Zhihu" data-toggle="tooltip" data-placement="top"><i class="icon icon-zhihu"></i></a></li>
        
        <li><a href="mailto:frank_lin@whu.edu.cn" target="_blank" title="Email" data-toggle="tooltip" data-placement="top"><i class="icon icon-email"></i></a></li>
        
    </ul>

    </nav>
    <!-- <script type="text/javascript" src="//js.users.51.la/19985869.js"></script> -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?9f90fd773669c197e7a4b7827da87a13";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
      
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <img src="/assets/weixin/qrcode.png" style="width:80%;margin-left:11%;"> <p style="text-align:center;">微信订阅号：全栈开发社区<br>fullstack tutorial developer</p>
            </div>
        </div>
    </div>
</div>

    
      
    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/influxdb/">influxdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skill-tree/">skill-tree</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ss/">ss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内网穿透/">内网穿透</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习宝典/">学习宝典</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发工具/">开发工具</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术世界/">技术世界</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库结构与算法/">数据库结构与算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂文/">杂文</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/校招/">校招</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Git/" style="font-size: 13px;">Git</a> <a href="/tags/HTTP/" style="font-size: 13px;">HTTP</a> <a href="/tags/IDEA/" style="font-size: 13px;">IDEA</a> <a href="/tags/Linux/" style="font-size: 13.5px;">Linux</a> <a href="/tags/PHP/" style="font-size: 13px;">PHP</a> <a href="/tags/influxdb/" style="font-size: 13px;">influxdb</a> <a href="/tags/skill-tree/" style="font-size: 13px;">skill-tree</a> <a href="/tags/ss/" style="font-size: 13px;">ss</a> <a href="/tags/内网穿透/" style="font-size: 13px;">内网穿透</a> <a href="/tags/前端/" style="font-size: 13px;">前端</a> <a href="/tags/学习宝典/" style="font-size: 13px;">学习宝典</a> <a href="/tags/开发工具/" style="font-size: 13.5px;">开发工具</a> <a href="/tags/技术世界/" style="font-size: 13.5px;">技术世界</a> <a href="/tags/数据库结构与算法/" style="font-size: 13px;">数据库结构与算法</a> <a href="/tags/杂文/" style="font-size: 13.5px;">杂文</a> <a href="/tags/校招/" style="font-size: 14px;">校招</a> <a href="/tags/深度学习/" style="font-size: 13px;">深度学习</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/09/25/java-regular-group/" class="title">Java 正则表达式的命名捕获组</a>
              </p>
              <p class="item-date">
                <time datetime="2021-09-25T08:45:04.000Z" itemprop="datePublished">2021-09-25</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/05/16/docs-tutorial/" class="title">开发者如何编写优雅的技术文档 —— 手把手教你编写极致的文档</a>
              </p>
              <p class="item-date">
                <time datetime="2021-05-16T14:05:37.000Z" itemprop="datePublished">2021-05-16</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/03/28/github-speed-up/" class="title">一行命令实现 Github 国内镜像加速</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-28T13:47:11.000Z" itemprop="datePublished">2021-03-28</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/03/28/let-is-encrypt-cerbot-for-https/" class="title">使用 Certbot 为网站签发永久免费的 HTTPS 证书</a>
              </p>
              <p class="item-date">
                <time datetime="2021-03-28T11:01:10.000Z" itemprop="datePublished">2021-03-28</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/05/31/about-campus-apply/" class="title">关于校招，你必须了解的那些事</a>
              </p>
              <p class="item-date">
                <time datetime="2020-05-31T08:19:49.000Z" itemprop="datePublished">2020-05-31</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一-概述"><span class="toc-number">1.</span> <span class="toc-text">一、概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-什么是内网穿透"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 什么是内网穿透</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-什么是-lanproxy"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 什么是 lanproxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-原理"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-快速指南"><span class="toc-number">2.</span> <span class="toc-text">二、快速指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#硬件与环境要求"><span class="toc-number">2.1.</span> <span class="toc-text">硬件与环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提供安装方式"><span class="toc-number">2.2.</span> <span class="toc-text">提供安装方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端与客户端"><span class="toc-number">2.3.</span> <span class="toc-text">服务端与客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-hub-镜像"><span class="toc-number">2.4.</span> <span class="toc-text">Docker Hub 镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-公网服务器配置-docker-一键启动"><span class="toc-number">3.</span> <span class="toc-text">三、公网服务器配置（Docker 一键启动）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-基础环境安装"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 基础环境安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-docker-启动服务端程序"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Docker 启动服务端程序 ⭐⭐⭐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#方式一：docker-run"><span class="toc-number">3.2.1.</span> <span class="toc-text">方式一：docker run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方式二：docker-compose"><span class="toc-number">3.2.2.</span> <span class="toc-text">方式二：docker compose</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-nginx-反向代理配置域名"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Nginx 反向代理配置域名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-继续配置-lanproxy-后台服务"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 继续配置 lanproxy 后台服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四-内网电脑客户端配置"><span class="toc-number">4.</span> <span class="toc-text">四、内网电脑客户端配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-强烈推荐：开箱即用的-docker-版客户端"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 强烈推荐：开箱即用的 Docker 版客户端 ⭐⭐⭐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#运行-lanproxy-client-服务"><span class="toc-number">4.1.1.</span> <span class="toc-text">运行 lanproxy client 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#方式一：docker-run-v2"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">方式一：docker run</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式二：docker-compose-v2"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">方式二：docker-compose</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lanproxy-网页后台服务查看"><span class="toc-number">4.1.2.</span> <span class="toc-text">lanproxy 网页后台服务查看</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-推荐：开箱即用客户端-仅需安装-java-环境"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 推荐：开箱即用客户端，仅需安装 Java 环境 ⭐⭐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#java-jdk-1-8-安装"><span class="toc-number">4.2.1.</span> <span class="toc-text">Java JDK 1.8 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#下载-java-客户端-开箱即用"><span class="toc-number">4.2.2.</span> <span class="toc-text">下载 Java 客户端（开箱即用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行-lanproxy-client-服务-v2"><span class="toc-number">4.2.3.</span> <span class="toc-text">运行 lanproxy client 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lanproxy-网页后台服务查看-v2"><span class="toc-number">4.2.4.</span> <span class="toc-text">lanproxy 网页后台服务查看</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-java-客户端-通过-maven-方式安装依赖"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 Java 客户端，通过 Maven 方式安装依赖 ⭐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#java-1-8-安装"><span class="toc-number">4.3.1.</span> <span class="toc-text">Java 1.8 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#maven-安装"><span class="toc-number">4.3.2.</span> <span class="toc-text">maven 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动内网服务"><span class="toc-number">4.3.3.</span> <span class="toc-text">启动内网服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行-lanproxy-client-服务-v3"><span class="toc-number">4.3.4.</span> <span class="toc-text">运行 lanproxy client 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lanproxy-网页后台服务查看-v3"><span class="toc-number">4.3.5.</span> <span class="toc-text">lanproxy 网页后台服务查看</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-go-客户端"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 Go 客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-go-环境安装"><span class="toc-number">4.4.1.</span> <span class="toc-text">安装 Go 环境安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#拉取-ffay-lanproxy-go-client-代码"><span class="toc-number">4.4.2.</span> <span class="toc-text">拉取 ffay/lanproxy-go-client 代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装客户端依赖包"><span class="toc-number">4.4.3.</span> <span class="toc-text">安装客户端依赖包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动客户端"><span class="toc-number">4.4.4.</span> <span class="toc-text">启动客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lanproxy-网页后台服务查看-v4"><span class="toc-number">4.4.5.</span> <span class="toc-text">lanproxy 网页后台服务查看</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五-总结"><span class="toc-number">5.</span> <span class="toc-text">五、总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#todo-list"><span class="toc-number">6.</span> <span class="toc-text">Todo List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于作者-boy"><span class="toc-number">8.</span> <span class="toc-text">关于作者 :boy:</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-手把手教你，搭建内网穿透服务" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      手把手教你，搭建内网穿透服务
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2018/12/17/手把手教你，搭建内网穿透服务/" class="article-date">
	  <time datetime="2018-12-17T08:49:11.000Z" itemprop="datePublished">2018-12-17 16:49:11</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link" href="/tags/内网穿透/">内网穿透</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2018/12/17/手把手教你，搭建内网穿透服务/#comments" class="article-comment-link">评论</a></span>
        
	
		<!-- <font color=#1a2433>🎯置顶</font> -->
		<!-- <span>  </span>
		<i class="icon icon-edit"></i> -->
		<!-- <span class="post-wordcount hidden-xs" itemprop="wordCount">字数：5.8k words</span> -->
	
	
		<span>  </span>
		<i class="icon icon-time"></i>
		<!-- <span class="post-wordcount hidden-xs" itemprop="wordCount">字数：5.8k words,</span> -->

		<span class="post-wordcount hidden-xs" itemprop="wordCount">5.8k words, 24 mins</span>
		<!-- <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读：24 mins</span> -->
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>在很多场景下内网穿透都是我们常常遇到的需求，之前也用过花生壳、ngrok、FRP 等等一些工具，但是由于限速、收费、安全各方面因素只好放弃了。</p>
<p>目前所在实验室主要从事深度学习和机器学习相关工作，有一台高配 GPU 计算型服务器，大家使用 Jupyter Notebook 在网页上进行编码工作，但是只能在学院内网才能进行使用，在外面就无法使用让人比较抓狂。如果购买阿里云等深度学习服务，价格昂贵，只好决定通过内网穿透实现公网工作。</p>
<p>近期无意间看到 <a href="https://github.com/ffay/lanproxy" target="_blank" rel="noopener">「传送门：lanproxy」</a> 这款开源工具，正好实验室购置了一台公网服务器，正好可以实现内网穿透，决定入坑折腾一番。对于有后台开发基础的同学还是挺简单的，不过好记性不如烂笔头，来吧，这里手把手深入探索一番。</p>
<h2 id="一-概述">一、概述</h2>
<h3 id="1-1-什么是内网穿透">1.1 什么是内网穿透</h3>
<p>好吧，先上一段百度百科的定义</p>
<blockquote>
<p>内网穿透，即NAT穿透，网络连接时术语，计算机是局域网内时，外网与内网的计算机节点需要连接通信，有时就会出现不支持内网穿透。</p>
</blockquote>
<p>反正简单来说，就是能通过公网访问你的内网服务，把你的内网通过一台公网服务器，穿透出去。</p>
<h3 id="1-2-什么是-lanproxy">1.2 什么是 lanproxy</h3>
<p>lanproxy 是一个将局域网个人电脑、服务器代理到公网的内网穿透工具，目前仅支持 tcp 流量转发，可支持任何 tcp 上层协议（访问内网网站、本地支付接口调试、ssh 访问、远程桌面…）。目前市面上提供类似服务的有花生壳、TeamView、GoToMyCloud 等等，但要使用第三方的公网服务器就必须为第三方付费，并且这些服务都有各种各样的限制，此外，由于数据包会流经第三方，因此对数据安全也是一大隐患。<a href="https://lanproxy.io2c.com/" target="_blank" rel="noopener">https://lanproxy.io2c.com</a></p>
<h3 id="1-3-原理">1.3 原理</h3>
<p>内网穿透的原理如下图所示：</p>
<ol>
<li>
<p>用户访问我们的服务器，这个服务器是有公网IP的，所以用户可以无压力访问</p>
</li>
<li>
<p>服务器与本地电脑保持长链接，当有请求的时候，服务器将请求转发到我们的本地电脑</p>
</li>
<li>
<p>本地电脑将响应回复给服务器</p>
</li>
<li>
<p>服务器将响应回复给用户</p>
<div align="center"><img src="/assets/1547174721865.png" width></div>
</li>
</ol>
<p>要搭建内网穿透，我们得完成两个任务</p>
<ol>
<li>在公网能访问的服务器上运行我们的内网穿透服务；</li>
<li>在本地电脑上面运行内网穿透客户端。</li>
</ol>
<p>当然，你可以自己根据原理实现一套，不过我们有现成的三方开源工具，可以帮我们实现这一套功能。这个就是我们今天的主角 <a href="https://github.com/ffay/lanproxy" target="_blank" rel="noopener">lanproxy</a>。</p>
<h2 id="二-快速指南">二、快速指南</h2>
<blockquote>
<p>这里我将手把手带你配置 lanproxy 穿透服务，这里配置主要分成了 <strong>公网服务器配置</strong>（请按照 2.2 中的说明进行安装） 和 <strong>内网电脑配置</strong>（推荐通过 4.1 中的说明安装） 。</p>
<p>在内网电脑配置中分为：Java 客户端和 GO 客户端</p>
</blockquote>
<h3 id="硬件与环境要求">硬件与环境要求</h3>
<blockquote>
<p>这里以我的环境为例</p>
</blockquote>
<ol>
<li><strong>一台公网服务器</strong>（Centos 7.4，当然这不重要，反正都 docker 啦）
<ul>
<li>docker（简化更多的配置，这里采用 docker 容器进行搭建）</li>
<li>Nginx 环境</li>
</ul>
</li>
<li><strong>一台内网电脑</strong>（Ubuntu 16.04）
<ul>
<li>这里提供了四种方式进行客户端启动
<ul>
<li>Docker容器部署</li>
<li>Java &gt; 1.7 的 JDK环境 + 客户端下载</li>
<li>Java &gt; 1.7 的 JDK环境 + maven + 源码下载</li>
<li>Go 客户端下载启动</li>
</ul>
</li>
<li>docker 启动服务，tensorflow（jupyter notebook）</li>
</ul>
</li>
<li><strong>已备案的域名</strong>（可选）
<ul>
<li>此步骤也可省略，但端口太多通过 Nginx 配合域名进行转发，使用更加优雅。故这里我也将会配置两个公网域名</li>
</ul>
</li>
</ol>
<h3 id="提供安装方式">提供安装方式</h3>
<table width border="0" cellpadding="0" cellspacing="0">
   <col width="94.47" style="mso-width-source:userset;mso-width-alt:3022;">
   <col width="125.47" style="mso-width-source:userset;mso-width-alt:4014;">
   <col width="90.27" style="mso-width-source:userset;mso-width-alt:2888;">
   <col width="373.73" span="2" style="mso-width-source:userset;mso-width-alt:11959;">
   <tr height="18" style="height:13.50pt;">
    <td class="xl65" height="18" width="94.47" style="height:13.50pt;width:70.85pt;" x:str>安装服务</td>
    <td class="xl65" width="150" style="width:94.10pt;" x:str>说明</td>
    <td class="xl65" width="90.27" style="width:67.70pt;" x:str>推荐</td>
    <td class="xl65" width="400" style="width:280.30pt;" x:str>安装方式</td>
   </tr>
   <tr height="18" style="height:13.50pt;">
    <td class="xl66" height="18" style="height:13.50pt;" x:str>服务端</td>
    <td class="xl66" x:str>一台公网服务器</td>
    <td class="xl66" x:str>⭐⭐⭐</td>
    <td x:str>方式1：Docker容器部署</td>
   </tr>
   <tr height="18" style="height:13.50pt;">
    <td class="xl66" height="72" rowspan="4" style="height:54.00pt;border-right:none;border-bottom:none;" x:str>客户端</td>
    <td class="xl66" rowspan="4" style="border-right:none;border-bottom:none;" x:str>一台内网电脑</td>
    <td class="xl66" x:str>⭐⭐⭐</td>
    <td x:str>方式1：Docker容器部署</td>
   </tr>
   <tr height="18" style="height:13.50pt;">
    <td class="xl66" x:str>⭐⭐</td>
    <td x:str>方式2：Java &gt; 1.7 的 JDK环境 + 客户端下载</td>
   </tr>
   <tr height="18" style="height:13.50pt;">
    <td class="xl66" x:str>⭐</td>
    <td x:str>方式3：Java &gt; 1.7 的 JDK环境 + maven + 源码下载</td>
   </tr>
   <tr height="18" style="height:13.50pt;">
    <td class="xl66" x:str>⭐</td>
    <td x:str>方式4：Go 客户端下载启动</td>
   </tr>
  </table>
<h3 id="服务端与客户端">服务端与客户端</h3>
<table>
<thead>
<tr>
<th>服务</th>
<th>下载地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>lanproxy client for java</td>
<td><a href="https://github.com/frank-lam/lanproxy-client" target="_blank" rel="noopener">GitHub</a></td>
</tr>
<tr>
<td>lanproxy server for java</td>
<td><a href="https://github.com/frank-lam/lanproxy-server" target="_blank" rel="noopener">GitHub</a></td>
</tr>
</tbody>
</table>
<h3 id="docker-hub-镜像">Docker Hub 镜像</h3>
<table>
<thead>
<tr>
<th>镜像</th>
<th>下载地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>franklin5/lanproxy-server</td>
<td><a href="https://cloud.docker.com/u/franklin5/repository/docker/franklin5/lanproxy-server" target="_blank" rel="noopener">Docker Hub</a></td>
</tr>
<tr>
<td>franklin5/lanproxy-client</td>
<td><a href="https://cloud.docker.com/repository/docker/franklin5/lanproxy-client" target="_blank" rel="noopener">Docker Hub</a></td>
</tr>
</tbody>
</table>
<h2 id="三-公网服务器配置-docker-一键启动">三、公网服务器配置（Docker 一键启动）</h2>
<h3 id="3-1-基础环境安装">3.1 基础环境安装</h3>
<ol>
<li>安装 docker 服务，以 CentOS 7.4 为例</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1、安装依赖包</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install -y yum-utils  device-mapper-persistent-data  lvm2</span></span><br><span class="line"></span><br><span class="line">2、设置稳定版仓库</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum-config-manager   --add-repo  https://download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line"></span><br><span class="line">3、安装</span><br><span class="line">//安装最新版本</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install docker-ce</span></span><br><span class="line"></span><br><span class="line">//或者安装指定版本</span><br><span class="line"><span class="meta">$</span><span class="bash"> yum list docker-ce --showduplicates | sort -r</span></span><br><span class="line">    //显示有以下版本</span><br><span class="line">    docker-ce.x86_64            18.03.0.ce-1.el7.centos             docker-ce-stable</span><br><span class="line">//指定一个版本进行安装</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install docker-ce-&lt;VERSION STRING&gt;</span></span><br><span class="line"></span><br><span class="line">4、启动doker</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start docker</span></span><br><span class="line"></span><br><span class="line">5、通过运行hello-world镜像验证安装是否成功</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker run hello-world</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>安装 Nginx 服务，以 CentOS 7.4 为例</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.添加Nginx到YUM源</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">2.安装Nginx</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install -y nginx</span></span><br><span class="line">Nginx将完成安装在你的CentOS 7 服务器中。</span><br><span class="line"></span><br><span class="line">3.启动Nginx</span><br><span class="line"><span class="meta">$</span><span class="bash"> service nginx start</span></span><br></pre></td></tr></table></figure>
<ul>
<li>更多配置请参考：<a href="https://blog.csdn.net/u012486840/article/details/52610320" target="_blank" rel="noopener">CentOS 7 yum 安装 Nginx - 菜鸟路上的小白 - CSDN博客</a></li>
</ul>
<h3 id="3-2-docker-启动服务端程序">3.2 Docker 启动服务端程序 ⭐⭐⭐</h3>
<h4 id="方式一：docker-run">方式一：docker run</h4>
<ul>
<li>通过 Docker，启动 lanproxy 服务，<code>service docker start</code></li>
<li>启动 Docker 后运行一下代码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">           --name lanproxy-server \</span><br><span class="line">           -p 8090:8090 \</span><br><span class="line">           -p 4900:4900 \</span><br><span class="line">           -p 4993:4993 \</span><br><span class="line">           -p 9000-9100:9000-9100 \</span><br><span class="line">           --restart=always \</span><br><span class="line">           -e LANPROXY_USERNAME="admin" \</span><br><span class="line">           -e LANPROXY_PASSWORD="admin" \</span><br><span class="line">           -v - /usr/local/docker/lanproxy-server/config-data:/root/.lanproxy \</span><br><span class="line">           franklin5/lanproxy-server</span><br></pre></td></tr></table></figure>
<ul>
<li>参数：
<ul>
<li>LANPROXY_USERNAME：配置后台管理账号，默认admin</li>
<li>LANPROXY_PASSWORD：配置后台管理密码，默认admin</li>
</ul>
</li>
<li>可选：我也为你创建了上述的下载脚本，方便每次的启动</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/frank-lam/</span>lanproxy-nat<span class="regexp">/master/</span>docker-server<span class="regexp">/docker-run.sh</span></span><br></pre></td></tr></table></figure>
<p>输入你的公网服务器 IP:8090，例如：<code>http://120.92.10.120:8090</code>，即可看到后台管理 Web 页面。好啦，到这里 lanproxy 的基础环境已经搭建成功，是不是很快，这就是 docker 的魅力。如果不用 docker 启动，请参考 lanproxy 的官方文档。</p>
<p>这里的 9000-9100 即为需要映射的端口地址，可以自定义设置。</p>
<p><img src="/assets/1546568207628.png" alt="1546568207628"></p>
<h4 id="方式二：docker-compose">方式二：docker compose</h4>
<ol>
<li>创建 docker-compose.yml 文件</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  lanproxy-client:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">franklin5/lanproxy-server</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">lanproxy-server</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line">     <span class="comment"># 配置后台管理账号，默认admin</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">LANPROXY_USERNAME=admin</span></span><br><span class="line">     <span class="comment"># 配置后台管理密码，默认admin</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">LANPROXY_PASSWORD=admin</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line">     <span class="comment"># 用于保存创建的配置文件，避免重启服务后配置消失</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">/usr/local/docker/lanproxy-server/config-data:/root/.lanproxy</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="number">8090</span><span class="string">:8090</span></span><br><span class="line"><span class="bullet">     -</span> <span class="number">4900</span><span class="string">:4900</span></span><br><span class="line"><span class="bullet">     -</span> <span class="number">4993</span><span class="string">:4993</span></span><br><span class="line"><span class="bullet">     -</span> <span class="number">9000</span><span class="bullet">-9100</span><span class="string">:9000-9100</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>
<ul>
<li>可选：你可以手工复制创建，当然这里也为你提供方便下载的 <code>docker-compose.yml</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/frank-lam/lanproxy-nat/master/docker-server/docker-compose.yml</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>启动服务</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>停止服务</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>
<p>😎 至此你的 lanproxy 服务端已经配置成功，账号密码：即为 docker 配置中你配置的账号密码</p>
<p><img src="/assets/1546568207628.png" alt="1546568207628"></p>
<h3 id="3-3-nginx-反向代理配置域名">3.3 Nginx 反向代理配置域名</h3>
<p>在上一步，我们通过 docker 启动了一个 lanproxy 环境，但是通过 IP 和端口号组合的方式并不优雅。这里我将解析两个域名通过 Nginx 进行端口转发。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 两个域名都解析到你的公网上去</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个域名由于访问 lanproxy 管理后台</span></span><br><span class="line">lanproxy.frankfeekr.cn  =&gt; 120.92.10.120  | Nginx to =&gt; 127.0.0.1:8090</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个域名由于访问你的内网电脑服务，9000 端口可自由的在 lanproxy 管理后台进行配置</span></span><br><span class="line">jupyter.frankfeekr.cn   =&gt; 120.92.10.120  | Nginx to =&gt; 127.0.0.1:9000</span><br></pre></td></tr></table></figure>
<p>好啦，上门就是对域名进行了一些简单的解释，现在开始 Nginx 的配置</p>
<ol>
<li>
<p>进入 <code>/etc/nginx/conf.d</code> Nginx 的配置目录，在这里创建配置文件</p>
</li>
<li>
<p>创建 <code>lanproxy.frankfeekr.cn.conf</code> 配置文件</p>
</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="comment"># 这里使用自己的域名</span></span><br><span class="line">    <span class="string">server_name</span> <span class="string">lanproxy.frankfeekr.cn;</span></span><br><span class="line">    <span class="string">charset</span> <span class="string">utf-8;</span></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">proxy_set_header</span>   <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">        <span class="string">proxy_set_header</span>   <span class="string">Host</span>      <span class="string">$http_host;</span></span><br><span class="line">        <span class="comment"># 这里根据你的 lanproxy 配置，改成 config.server.port的值</span></span><br><span class="line">        <span class="string">proxy_pass</span>       <span class="attr">http://127.0.0.1:8090;</span></span><br><span class="line">        <span class="string">client_max_body_size</span> <span class="number">35</span><span class="string">m;</span></span><br><span class="line">        <span class="string">proxy_http_version</span> <span class="number">1.1</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Upgrade</span> <span class="string">$http_upgrade;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">"upgrade"</span><span class="string">;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>创建  <code>jupyter.frankfeekr.cn.conf</code> 配置文件</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="comment"># 这里使用自己的域名</span></span><br><span class="line">    <span class="string">server_name</span> <span class="string">jupyter.frankfeekr.cn;</span></span><br><span class="line">    <span class="string">charset</span> <span class="string">utf-8;</span></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">proxy_set_header</span>   <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">        <span class="string">proxy_set_header</span>   <span class="string">Host</span>      <span class="string">$http_host;</span></span><br><span class="line">        <span class="comment"># 这里根据你的lanproxy配置，改成 外网接口 的值，在lanproxy后台网页上配置，后面配置</span></span><br><span class="line">        <span class="string">proxy_pass</span>       <span class="attr">http://127.0.0.1:9000;</span></span><br><span class="line">        <span class="string">client_max_body_size</span> <span class="number">35</span><span class="string">m;</span></span><br><span class="line">        <span class="string">proxy_http_version</span> <span class="number">1.1</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Upgrade</span> <span class="string">$http_upgrade;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">"upgrade"</span><span class="string">;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>重启 Nginx 服务</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> service nginx restart</span></span><br></pre></td></tr></table></figure>
<p>😚 至此，你可以通过域名 <a href="http://lanproxy.frankfeekr.cn" target="_blank" rel="noopener">http://lanproxy.frankfeekr.cn</a> 进行访问 lanproxy 网页后台配置</p>
<h3 id="3-4-继续配置-lanproxy-后台服务">3.4 继续配置 lanproxy 后台服务</h3>
<ol>
<li>添加一个客户端</li>
</ol>
<p><img src="/assets/1544795186699.png" alt="1544795186699"></p>
<ol start="2">
<li>添加配置</li>
</ol>
<p><img src="/assets/1544795764181.png" alt="1544795764181"></p>
<p>如果准备使用 Docker 客户端启动服务的请注意 🔥🔥🔥</p>
<ol>
<li>如果通过 Java 客户端直接在主机启动客户端服务则 IP 地址为：<code>127.0.0.1:port</code> ；</li>
<li>如果通过 Docker 方式启动客户端，则 IP 地址为：<code>172.17.0.1:port</code>，这是 Docker 宿主机默认网卡 IP，如果自己手动修改过了 IP 地址，则填写你的 IP。可以通过命令 <code>ip a | grep docker</code> 查看你的宿主机 IP 地址。</li>
</ol>
<p>😜 至此，服务端的配置就完成了。下面开始内网电脑的配置。</p>
<h2 id="四-内网电脑客户端配置">四、内网电脑客户端配置</h2>
<h3 id="4-1-强烈推荐：开箱即用的-docker-版客户端">4.1 强烈推荐：开箱即用的 Docker 版客户端 ⭐⭐⭐</h3>
<blockquote>
<p>由于在不同的主机上配置客户端，发现非常消耗时间，同时也缺乏稳定性。于是决定来定制一款开箱即用的 docker 容器版客户端，这里你将不需要安装任何客户端环境，甚至只需要几行优雅的命令即可启动一个客户端，速度和服务端配置一样飞起来。</p>
</blockquote>
<p>lanproxy-client docker images：<a href="https://cloud.docker.com/repository/docker/franklin5/lanproxy-client" target="_blank" rel="noopener">franklin5/lanproxy-client - Docker Hub</a></p>
<h4 id="运行-lanproxy-client-服务">运行 lanproxy client 服务</h4>
<h5 id="方式一：docker-run-v2">方式一：docker run</h5>
<ol>
<li>一键启动客户端</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">           --name lanproxy-client \</span><br><span class="line">           -e LANPROXY_KEY="input_your_key" \</span><br><span class="line">           -e LANPROXY_HOST="input_your_host" \</span><br><span class="line">           --restart=always \</span><br><span class="line">           franklin5/lanproxy-client</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<ul>
<li>input_your_key：这里是在 lanproxy 后台配置的密钥</li>
<li>input_your_host：服务器的 ip，支持域名</li>
</ul>
<ul>
<li>可选：为了这里也为你提供了执行的 <code>docker-run.sh</code> （保存成 shell 修改和运行更方便）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/frank-lam/lanproxy-nat/master/docker-client/docker-run.sh</span><br></pre></td></tr></table></figure>
<ol>
<li>停止容器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop lanproxy-client</span><br></pre></td></tr></table></figure>
<ol>
<li>删除容器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm lanproxy-client</span><br></pre></td></tr></table></figure>
<ol>
<li>强制删除容器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f lanproxy-client</span><br></pre></td></tr></table></figure>
<ol>
<li>重启容器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart lanproxy-client</span><br></pre></td></tr></table></figure>
<h5 id="方式二：docker-compose-v2">方式二：docker-compose</h5>
<ol>
<li>在你的项目目录下创建：docker-compose.yml</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  lanproxy-client:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">franklin5/lanproxy-client</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">lanproxy-client</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line">     <span class="comment"># 这里是在lanproxy后台配置的密钥</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">LANPROXY_KEY=input_your_key</span></span><br><span class="line">     <span class="comment"># 服务器的ip，支持域名</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">LANPROXY_HOST=input_your_host</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>
<ul>
<li>可选：你可以手工复制创建，当然这里也为你提供方便下载的 <code>docker-compose.yml</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/frank-lam/lanproxy-nat/master/docker-client/docker-compose.yml</span><br></pre></td></tr></table></figure>
<ol>
<li>后台启动容器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p><strong>🚩使用 docker 方式运行客户端，请务必阅读</strong></p>
<blockquote>
<p>以上两种运行方式，选择一种运行即可一键启动 docker 客户端容器。但使用 docker 直接运行容器和在宿主机上运行时有所不同。在 docker 服务启动后，docker 会为宿主机和容器各自分配一个 docker 网卡，而宿主机上会分配默认的 IP 地址，即：<code>172.17.0.1</code>，故容器中可以 ping 通宿主机上 <code>172.17.0.1</code> 的任何 TCP 端口。</p>
<p>所以我们在后面的后台网页上的端口配置，不再是 <code>172.0.0.1</code>，必须是 <code>172.17.0.1:port</code>。</p>
<p>话不多说，请进入下一个步奏慢慢体会。</p>
</blockquote>
<h4 id="lanproxy-网页后台服务查看">lanproxy 网页后台服务查看</h4>
<p>客户端启动服务后，后台可查看状态（在线 / 离线）</p>
<p><img src="/assets/1544798600592.png" alt="1544798600592"></p>
<p>流量统计</p>
<p><img src="/assets/1544798624799.png" alt="1544798624799"></p>
<h3 id="4-2-推荐：开箱即用客户端-仅需安装-java-环境">4.2 推荐：开箱即用客户端，仅需安装 Java 环境 ⭐⭐</h3>
<blockquote>
<p>如果你的本地已经有了 Java 环境（无论你是编译安装，还是 yum/apt-get 安装，都 ok），最低环境 JDK 1.7 以上。那么我推荐你是用本节中的配置说明，可以不用配置 maven 环境，直接拉取客户端一键运行，更加方便。</p>
</blockquote>
<h4 id="java-jdk-1-8-安装">Java JDK 1.8 安装</h4>
<ol>
<li>验证你的本地是否有 Java 环境，如果已经存在 Java 1.7 以上的环境，即可调到下一个步骤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>安装 Java 1.8（Ubuntu/apt-get）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 首先，更新包索引</span></span><br><span class="line">apt-get update</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装Java运行时环境（JRE）</span></span><br><span class="line">apt-get install default-jre -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证安装是否成功</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p>详细可参考：<a href="https://www.cnblogs.com/guxiaobei/p/8556586.html" target="_blank" rel="noopener">在Ubuntu 16.04如何安装Java使用apt-get的 - 一只宅男的自我修养 - 博客园</a></p>
<ol start="3">
<li>安装 Java 1.8（Centos/yum）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 首先，更新包索引</span></span><br><span class="line">yum update</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 Java 1.8</span></span><br><span class="line">yum install java-1.8.0-openjdk.x86_64 -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证安装是否成功</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p>详细可参考：<a href="https://blog.csdn.net/a360616218/article/details/76736988" target="_blank" rel="noopener">centos7通过yum安装JDK1.8 - 来吧 单刷各种经典 - CSDN博客</a></p>
<h4 id="下载-java-客户端-开箱即用">下载 Java 客户端（开箱即用）</h4>
<ol>
<li>为了免去 mvn 安装中出现的意外，我已经为你打造了一款开箱即用的客户端</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/frank-lam/lanproxy-client.git</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>客户端目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x 7 root root 4096 Jan  2 08:17 ./</span><br><span class="line">drwxr-xr-x 1 root root 4096 Jan  2 08:17 ../</span><br><span class="line">drwxr-xr-x 8 root root 4096 Jan  2 08:17 .git/</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jan  2 08:17 distribution/</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jan  2 08:17 proxy-client/</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jan  2 08:17 proxy-common/</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jan  2 08:17 proxy-protocol/</span><br><span class="line">-rw-r--r-- 1 root root  606 Jan  2 08:17 restart.sh</span><br><span class="line">-rw-r--r-- 1 root root  570 Jan  2 08:17 start.sh</span><br><span class="line">-rw-r--r-- 1 root root  375 Jan  2 08:17 status.sh</span><br><span class="line">-rw-r--r-- 1 root root  588 Jan  2 08:17 stop.sh</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>修改配置文件信息<br>
打包完成之后，客户端文件会出现在 <code>distribution/proxy-client-0.1</code> 目录下，打开之后有是个文件夹：<code>bin</code>、<code>conf</code>、<code>lib</code>和<code>log</code>，配置信息在 <code>conf/config.properties</code> 文件内，根据前面服务端的配置信息修改一下。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里是在lanproxy后台配置的密钥</span></span><br><span class="line">client.key=e6a49a19b8024652ab4ff2210abf2c6a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置ssl信息，根据服务端的配置填写（enable = false 就不需要配置）</span></span><br><span class="line">ssl.enable=<span class="literal">false</span></span><br><span class="line">ssl.jksPath=test.jks</span><br><span class="line">ssl.keyStorePassword=123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器的ip，也支持域名</span></span><br><span class="line">server.host=120.92.10.120</span><br><span class="line"></span><br><span class="line"><span class="comment">#proxy-server ssl默认端口4993，默认普通端口4900</span></span><br><span class="line"><span class="comment">#ssl.enable=true时这里填写ssl端口，ssl.enable=false时这里填写普通端口</span></span><br><span class="line">server.port=4900</span><br></pre></td></tr></table></figure>
<h4 id="运行-lanproxy-client-服务-v2">运行 lanproxy client 服务</h4>
<ol>
<li>启动客户端（官方脚本）<br>
客户端信息配置完成之后就可以启动客户端了</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mac/linux使用这个</span></span><br><span class="line">$ bash  bin/startup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows 直接运行 bin/startup.bat</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>当然这里我也为你准备了一些开箱即用的脚本（推荐使用）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切换到项目根目录</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启</span></span><br><span class="line">sh restart.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">sh start.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止客户端</span></span><br><span class="line">sh stop.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 当前客户端运行状态</span></span><br><span class="line">sh status.sh</span><br></pre></td></tr></table></figure>
<h4 id="lanproxy-网页后台服务查看-v2">lanproxy 网页后台服务查看</h4>
<p>客户端启动服务后，后台可查看状态（在线 / 离线）</p>
<p><img src="/assets/1544798600592.png" alt="1544798600592"></p>
<p>流量统计</p>
<p><img src="/assets/1544798624799.png" alt="1544798624799"></p>
<h3 id="4-3-java-客户端-通过-maven-方式安装依赖">4.3 Java 客户端，通过 Maven 方式安装依赖 ⭐</h3>
<blockquote>
<p>这里我的内网是一台 Ubuntu 16.04 的服务器，以下我都将以此为例</p>
</blockquote>
<h4 id="java-1-8-安装">Java 1.8 安装</h4>
<ol>
<li>下载 JDK1.8（lanproxy 支持 JDK1.7 以上环境）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget https://download.oracle.com/otn-pub/java/jdk/8u191-b12/2787e4a523244c269598db4e85c51e0c/jdk-8u191-linux-x64.tar.gz</span></span><br></pre></td></tr></table></figure>
<ol>
<li>解压安装包，移动文件夹到 /user/lib 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf jdk-8u191-linux-x64.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv jdk1.8.0_191 /usr/lib/jdk/jdk1.8.0_191</span></span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>环境变量配置</p>
<p>这里是将环境变量配置在 etc/profile，即为所有用户配置 JDK 环境。</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim + etc/profile</span></span><br></pre></td></tr></table></figure>
<p>​	环境设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> java env</span></span><br><span class="line">export JAVA_HOME=/usr/lib/jdk/jdk1.8.0_191</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre    </span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib    </span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>​	执行命令使修改立即生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>配置软连接</p>
<p>软连接相当于windows系统中的快捷键，部分软件可能会从/usr/bin目录下查找Java，因此添加该软连接防止其他软件查找不到的情况。</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo update-alternatives --install /usr/bin/java  java  /usr/lib/jdk/jdk1.8.0_191/java 300   </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo update-alternatives --install /usr/bin/javac  javac  /usr/lib/jdk/jdk1.8.0_191/bin/javac 300</span></span><br></pre></td></tr></table></figure>
<ol>
<li>测试安装是否成功</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在终端输入，出现版本号则表示安装成功</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> java -version</span></span><br></pre></td></tr></table></figure>
<p>更详细文档：</p>
<ul>
<li><a href="https://blog.csdn.net/smile_from_2015/article/details/80056297" target="_blank" rel="noopener">ubuntu16.04搭建jdk1.8运行环境 - 朝花夕拾 - CSDN博客</a></li>
</ul>
<h4 id="maven-安装">maven 安装</h4>
<p>maven 是个项目管理工具，在编程领域应用广泛。</p>
<ol>
<li><a href="http://maven.apache.org/download.cgi" target="_blank" rel="noopener">官网</a> 下载maven。</li>
</ol>
<p><img src="/assets/20170724230855998.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget https://www-eu.apache.org/dist/maven/maven-3/3.6.0/binaries/apache-maven-3.6.0-bin.tar.gz</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>解压到 /opt/maven 目录</li>
</ol>
<p>创建 manve 目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo mkdir /opt/maven</span></span><br></pre></td></tr></table></figure>
<p>解压到 /opt/maven 目录下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo tar zxvf apache-maven-3.6.0-bin.tar.gz -C /opt/maven</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>配置 maven 环境</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim + /etc/profile</span></span><br></pre></td></tr></table></figure>
<p>在文件内容后面添加以下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> maven env</span></span><br><span class="line">export M2_HOME=/opt/maven/apache-maven-3.6.0</span><br><span class="line">export CLASSPATH=$CLASSPATH:$M2_HOME/lib</span><br><span class="line">export PATH=$PATH:$M2_HOME/bin</span><br></pre></td></tr></table></figure>
<p>保存，输入以下命令使配置文件生效。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure>
<p>验证是否安装成功。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mvn -v</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>修改 maven 源为阿里云，以及仓库默认存放路径。这样 maven 下载 jar 包的速度会快很多。</li>
</ol>
<p>打开 maven 的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /opt/maven/apache-maven-3.6.0/conf/settings.xml</span></span><br></pre></td></tr></table></figure>
<p>在 /home 目录下生成 maven/repository 文件夹</p>
<p><img src="/assets/1544797073237.png" alt="1544797073237"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>maven/reposity<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改源</p>
<p><img src="/assets/1544797106999.png" alt="1544797106999"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  　　<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>😚 至此，Maven 安装成功</p>
<p>参考资料：</p>
<ul>
<li><a href="https://blog.csdn.net/qq_24091555/article/details/76039475" target="_blank" rel="noopener">ubuntu16.04安装maven - Rocky的编程随记 - CSDN博客</a></li>
</ul>
<h4 id="启动内网服务">启动内网服务</h4>
<p>在前面我们将 <a href="http://jupyter.frankfeekr.cn" target="_blank" rel="noopener">jupyter.frankfeekr.cn</a> 反向代理（公网服务器 9000 服务，内网 5050）</p>
<p><img src="/assets/1544797593907.png" alt="1544797593907"></p>
<p>这里我们需要确保在内网电脑上，浏览器能够访问到 127.0.0.1:5050 这个服务。以我的 jupyter notebook 为例：</p>
<p><img src="/assets/1544797708925.png" alt="1544797708925"></p>
<p>这里，我的内网服务已经启动。接下来只需要启动 lanproxy 客户端即可。</p>
<h4 id="运行-lanproxy-client-服务-v3">运行 lanproxy client 服务</h4>
<p>官方提供了两种方式运行客户端，一种方式是使用官方提供的 GO，另一种通过 Java 环境运行。本文采用主流的 Java 方式运行</p>
<ol>
<li>克隆 <code>lanproxy</code> 代码到本地电脑</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/ffay/lanproxy.git lanproxy</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>打包 <code>lanproxy</code><br>
打包之前需要确保你安装了 <code>maven</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> lanproxy</span><br><span class="line">$ mvn package</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>修改配置文件信息<br>
打包完成之后，客户端文件会出现在 <code>distribution/proxy-client-0.1</code> 目录下，打开之后有是个文件夹：<code>bin</code>、<code>conf</code>、<code>lib</code>和<code>log</code>，配置信息在 <code>conf/config.properties</code> 文件内，根据前面服务端的配置信息修改一下。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里是在lanproxy后台配置的密钥</span></span><br><span class="line">client.key=e6a49a19b8024652ab4ff2210abf2c6a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置ssl信息，根据服务端的配置填写（enable = false 就不需要配置）</span></span><br><span class="line">ssl.enable=<span class="literal">false</span></span><br><span class="line">ssl.jksPath=test.jks</span><br><span class="line">ssl.keyStorePassword=123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器的ip</span></span><br><span class="line">server.host=120.92.10.120</span><br><span class="line"></span><br><span class="line"><span class="comment">#proxy-server ssl默认端口4993，默认普通端口4900</span></span><br><span class="line"><span class="comment">#ssl.enable=true时这里填写ssl端口，ssl.enable=false时这里填写普通端口</span></span><br><span class="line">server.port=4900</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>启动客户端<br>
客户端信息配置完成之后就可以启动客户端了</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mac/linux使用这个</span></span><br><span class="line">$ bash  bin/startup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows 直接运行 bin/startup.bat</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>
<p>访问测试</p>
<p>😚 至此，即可通过公网域名 <a href="http://jupyter.frankfeekr.cn" target="_blank" rel="noopener">http://jupyter.frankfeekr.cn</a> 访问内网服务，实现内网穿透</p>
</li>
</ol>
<p><img src="/assets/1544798196919.png" alt="1544798196919"></p>
<p>当然你也可以通过公网 IP 和域名访问，例如：<a href="http://120.92.10.120:9000" target="_blank" rel="noopener">http://120.92.10.120:9000</a> 这种方式访问！</p>
<ol start="6">
<li>停止客户端</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bash  bin/stop.sh</span></span><br></pre></td></tr></table></figure>
<h4 id="lanproxy-网页后台服务查看-v3">lanproxy 网页后台服务查看</h4>
<p>客户端启动服务后，后台可查看状态（在线 / 离线）</p>
<p><img src="/assets/1544798600592.png" alt="1544798600592"></p>
<p>流量统计</p>
<p><img src="/assets/1544798624799.png" alt="1544798624799"></p>
<h3 id="4-4-go-客户端">4.4 Go 客户端</h3>
<p>GitHub 客户端主页：<a href="https://github.com/ffay/lanproxy-go-client" target="_blank" rel="noopener">lanproxy-go-client</a></p>
<p>不想安装 Java 环境的可以选择 Go</p>
<h4 id="安装-go-环境安装">安装 Go 环境安装</h4>
<p><strong>1. buntu、Debian或Linux Mint安装Go语言</strong></p>
<p>基于 Debian的 Linux 发行版本都可以使用 apt-get 命令来进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install golang</span><br></pre></td></tr></table></figure>
<p>要查看当前系统安装的 Go 语言版本可以使用如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>
<p>由于 Go 代码必需保存在 workspace(工作区)中，所以我们必需在 <strong>Home</strong> 目录(例如 ~/workspace)创建一个<strong>workspace</strong> 目录并定义 <strong>GOPATH</strong> 环境变量指向该目录，这个目录将被 Go 工具用于保存和编辑二进制文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/workspace</span><br><span class="line">echo 'export GOPATH="$HOME/workspace"' &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>根据不同的需要，我们可以使用 apt-get 安装 Go tools：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-cache search golang</span><br></pre></td></tr></table></figure>
<p><strong>2. Fedora、CentOS或RHEL安装Go语言</strong></p>
<p>基于 Red Hat 的 Linux 发行版本都可以使用 yum 命令来进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br><span class="line">sudo yum install golang</span><br></pre></td></tr></table></figure>
<p>要查看当前系统安装的 Go 语言版本可以使用如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>
<p>接下来还是在 Home 目录(例如 ~/workspace)创建一个 workspace 目录并定义 GOPATH 环境变量指向该目录，这个目录将被 Go 工具用于保存和编辑二进制文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/workspace</span><br><span class="line">echo 'export GOPATH="$HOME/workspace"' &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>根据不同的需要，我们可以使用 yum 安装 Go tools：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum search golang</span><br></pre></td></tr></table></figure>
<p>参考资料：<a href="https://studygolang.com/articles/7482" target="_blank" rel="noopener">如何为Linux安装Go语言 - Go语言中文网 - Golang中文社区</a></p>
<h4 id="拉取-ffay-lanproxy-go-client-代码">拉取 ffay/lanproxy-go-client 代码</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ffay/lanproxy-go-client.git</span><br></pre></td></tr></table></figure>
<h4 id="安装客户端依赖包">安装客户端依赖包</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd lanproxy-go-client</span><br><span class="line">sh build-release.sh</span><br></pre></td></tr></table></figure>
<p>安装后，这时候在目录下会出现文件。</p>
<h4 id="启动客户端">启动客户端</h4>
<p><strong>普通端口连接</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mac 64位</span></span><br><span class="line">nohup ./client_darwin_amd64 -s SERVER_IP -p SERVER_PORT -k CLIENT_KEY &amp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> linux 64位</span></span><br><span class="line">nohup ./client_linux_amd64 -s SERVER_IP -p SERVER_PORT -k CLIENT_KEY &amp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> windows 64 位</span></span><br><span class="line">./client_windows_amd64.exe -s SERVER_IP -p SERVER_PORT -k CLIENT_KEY</span><br></pre></td></tr></table></figure>
<p><strong>SSL端口连接</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mac 64位</span></span><br><span class="line">nohup ./client_darwin_amd64 -s SERVER_IP -p SERVER_SSL_PORT -k CLIENT_KEY -ssl true &amp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> linux 64位</span></span><br><span class="line">nohup ./client_linux_amd64 -s SERVER_IP -p SERVER_SSL_PORT -k CLIENT_KEY -ssl true &amp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> windows 64 位</span></span><br><span class="line">./client_windows_amd64.exe -s SERVER_IP -p SERVER_SSL_PORT -k CLIENT_KEY -ssl true</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./client_linux_amd64 -s lp<span class="selector-class">.thingsglobal</span><span class="selector-class">.org</span> -<span class="selector-tag">p</span> <span class="number">4900</span> -k <span class="number">01</span>c1e176d6ee466c8db717a8 &amp;</span><br></pre></td></tr></table></figure>
<p>命令参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GLOBAL OPTIONS:</span><br><span class="line">   -k value       client key</span><br><span class="line">   -s value       proxy server host</span><br><span class="line">   -p value       proxy server port (default: 4900)</span><br><span class="line">   --ssl value    enable ssl (default: "false", -p value should be server ssl port)</span><br><span class="line">   --cer value    ssl cert path, default skip verify certificate</span><br><span class="line">   --help, -h     show help</span><br><span class="line">   --version, -v  print the version</span><br></pre></td></tr></table></figure>
<h4 id="lanproxy-网页后台服务查看-v4">lanproxy 网页后台服务查看</h4>
<p>客户端启动服务后，后台可查看状态（在线 / 离线）</p>
<p><img src="/assets/1544798600592.png" alt="1544798600592"></p>
<p>流量统计</p>
<p><img src="/assets/1544798624799.png" alt="1544798624799"></p>
<h2 id="五-总结">五、总结</h2>
<p>通过以上的配置，只要有一台公网电脑，即可实现内网穿透功能。摆脱花生壳的域名端口限制，流量限制，带宽限制。笔者的公网服务器为 6M 带宽，通过公网映射，文件下载测试大概在 800K/s - 1.5M/s 范围，如果仅是普通的网站服务完全可以完美穿透。</p>
<p>一般的应用场景：用来 SSH/MSTSC 远程连接，站点对外访问，是完全绰绰有余。</p>
<h2 id="todo-list">Todo List</h2>
<p>为了方便客户端批量安装，我将会编写更为方便的 shell 脚本，做到一键自动部署</p>
<ul>
<li>[ ] 一键 shell 脚本安装</li>
<li>[ ] 交互式 shell 脚本安装</li>
</ul>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://www.fengqiangboy.com/15229403526064.html" target="_blank" rel="noopener">基于docker搭建lanproxy内网穿透服务 - 奉强的个人博客</a></li>
<li><a href="https://github.com/fengqiangboy/lanproxy-docker" target="_blank" rel="noopener">lanproxy GitHub 官方主页</a></li>
<li><a href="https://www.cnblogs.com/ssooking/p/6094740.html" target="_blank" rel="noopener">linux设置开机自启动 - ssooking - 博客园</a></li>
</ul>
<h2 id="关于作者-boy">关于作者 :boy:</h2>
<div align="center">  
    <p>
        在颠覆世界的同时，也要好好关照自己。
    </p>
<a target="_blank" href="https://zhuanlan.zhihu.com/frankfeekr" rel="nofollow"><img src="https://img.shields.io/badge/知乎专栏-frankfeekr-blue.svg" alt="QQ群" data-canonical-src style="max-width:100%;"></a>
<a target="_blank" href="http://blog.csdn.net/u012104219" rel="nofollow"><img src="https://img.shields.io/badge/CSDN-东风牧野-red.svg" alt="CSDN" data-canonical-src style="max-width:100%;"></a>
<a target="_blank" href="mailto:frank_lin@whu.edu.cn" rel="nofollow"><img src="https://img.shields.io/badge/Email-frank__lin@whu.edu.cn-lightgrey.svg" alt="邮箱" data-canonical-src style="max-width:100%;"></a>
<a target="_blank" href="https://jq.qq.com/?_wv=1027&k=593WvX0" rel="nofollow"><img src="https://img.shields.io/badge/QQ群-862619503-green.svg" alt="QQ群" data-canonical-src style="max-width:100%;"></a>
    <br><br>
    <p>
        from zero to hero.
    </p>
</div>
<div align="center"><img src="https://raw.githubusercontent.com/frank-lam/fullstack-tutorial/master/assets/wechat-fullstack.png" width="620"></div><br>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.frankfeekr.cn/2018/12/17/手把手教你，搭建内网穿透服务/" title="手把手教你，搭建内网穿透服务" target="_blank" rel="external">http://www.frankfeekr.cn/2018/12/17/手把手教你，搭建内网穿透服务/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/frank-lam" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/img/avatar2.jpg" class="img-rounded w-full" alt>
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/frank-lam" target="_blank"><span class="text-dark">Frank</span><small class="ml-1x">from zero to hero</small></a></h3>
        <div>潜伏在黎明之前，混迹于互联网江湖。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
           
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2019/01/04/打开Docker大门/" title="打开 Docker 大门"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2018/10/19/我的校招之路/" title="我的校招之路"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/img/donate/alipay.jpg" alt="扫码支持" title="扫一扫">
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/img/donate/wechat.jpg" alt="扫码支持" title="扫一扫">
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class>
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
    
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/frank-lam" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/Lam_Frank" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://www.zhihu.com/people/hifrank/" target="_blank" title="Zhihu" data-toggle="tooltip" data-placement="top"><i class="icon icon-zhihu"></i></a></li>
        
        <li><a href="mailto:frank_lin@whu.edu.cn" target="_blank" title="Email" data-toggle="tooltip" data-placement="top"><i class="icon icon-email"></i></a></li>
        
    </ul>

    <div class="copyright">
        
        <div class="publishby">
            <!-- <span id="busuanzi_container_site_pv">访问量：<span id="busuanzi_value_site_pv"></span>次</span><br/> -->
            <!-- frank_lin@whu.edu.cn <br /> -->
            <!-- fullstack-tutorial -->
            <!-- <br> -->
            <iframe style="height: 20px !important;" frameborder="0" scrolling="0" width="120px" height="20px" src="https://ghbtns.com/github-btn.html?user=frank-lam&repo=fullstack-tutorial&type=star&count=true">
            </iframe><br>
            <!-- <p id="about_51la">
                <script type="text/javascript" src="//quote.51.la/q?id=19985869&mb=4"></script>
            </p> -->
            <p>
                <span id="busuanzi_container_site_pv">总访问量 <span id="busuanzi_value_site_pv"></span> </span>
                <br>
                <a href="https://beian.miit.gov.cn" target="_blank" style="border-bottom: 1px dashed #ffffffbf;">浙ICP备2021008991号</a>
            </p>
            <!-- Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>. -->
        </div>
    </div>
    <script>
        // setTimeout(function () {
        //     $('#about_51la').prepend(`<span>${$('#about_51la a').text()}</span>`)
        //     $('#about_51la a').remove()
        // }, 1000);

        do {
            console.log("loading 51.la");
        }
        while (document.getElementById("about_51la").length == 1) {
            setTimeout(function () {
                $('#about_51la').prepend(`<span>${$('#about_51la a').text()}</span>`)
                $('#about_51la a').remove()

            }, 500);
            // $('#about_51la').prepend(`<span>${$('#about_51la a').text()}</span>`)
            // $('#about_51la a').remove()
        }
        // while ($('#about_51la').length == 1) {

        // }

        // setTimeout(function(){
        //     console.log($('#about_51la').length);
        //     if($('#about_51la p')){
        //         alert("exist");
        //     }
        //     else{
        //         alert("not exist");
        //     }
        //     console.log($('#about_51la span'));
        //     $('#about_51la').prepend(`<span>${$('#about_51la a').text()}</span>`)
        //     $('#about_51la a').remove()
        //  }, 2000);

    </script>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.min.js"></script>
<script src="/js/application.js"></script>

    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>





   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script async src="https://cdn.jsdelivr.net/gh/frank-lam/hexo-blog-site/js/busuanzi.pure.mini.js"></script> -->





   
    
  <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"> -->
  <!-- <script src="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: '321c793b57e48017d3d6',
    clientSecret: '525a416540a4b84efca2e7cdf218edddcd7c2b00',
    repo: 'hexo-blog-gitalk',
    owner: 'frank-lam',
    admin: ['frank-lam'],
    id: md5(location.pathname),
    distractionFreeMode: true
  })
  gitalk.render('comments')
  </script>

      



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      if ($(this).hasClass('nofancybox')) return;
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>